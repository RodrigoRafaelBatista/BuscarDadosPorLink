import requests
import math  
from datetime import date, timedelta
import threading
import pandas as pd
from time import sleep


def extrair_cnpjs_municipios(url, data, page: int = 1, municipio: str = ""):

    payload = {
        "query": {
            "termo": [],
            "atividade_principal": [],
            "natureza_juridica": [],
            "uf": ["MG", "RS"],
            "municipio": [municipio],
            "bairro": [],
            "situacao_cadastral": "ATIVA",
            "cep": [],
            "ddd": []
        },
        "range_query": {
            "data_abertura": {
                "lte": data,
                "gte": data
            },
            "capital_social": {
                "lte": None,
                "gte": None
            }
        },
        "extras": {
            "somente_mei": False,
            "excluir_mei": False,
            "com_email": False,
            "incluir_atividade_secundaria": False,
            "com_contato_telefonico": False,
            "somente_fixo": False,
            "somente_celular": False,
            "somente_matriz": False,
            "somente_filial": False
        },
        "page": page,
        "order_by": "cnpj asc"
    }
    headers = {
        "authority": "api.casadosdados.com.br",
        "accept": "application/json",
        "accept-language": "pt-BR,pt;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6",
        "content-type": "application/json",
        "origin": "https://casadosdados.com.br",
        "referer": "https://casadosdados.com.br/",
        "sec-ch-ua": "^\^Not_A",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "^\^Windows^^",
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-site",
        "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0"
    }

    return requests.request("POST", url, json=payload, headers=headers).json()

def consultar(municipio: list = []):
    urls_geradas = []
    for i, municipio in enumerate(municipio):
        cnpjs = extrair_cnpjs_municipios("https://api.casadosdados.com.br/v2/public/cnpj/search", data_consultar, page=1, municipio=municipio)
        total_empresas = math.ceil(cnpjs['data']['count'])
        while len(urls_geradas) < total_empresas:
            total_de_paginas = math.ceil(total_empresas/20)
            if total_de_paginas > 50:
                total_de_paginas = 50
            # print(f"{total_de_paginas = }")
            for i in range(total_de_paginas):
                cnpjs = extrair_cnpjs_municipios("https://api.casadosdados.com.br/v2/public/cnpj/search", data_consultar, page=i, municipio=municipio)
                # print(f"{cnpjs['data'] = }")

                total_empresas = math.ceil(cnpjs['data']['count'])
                # print(f"{total_de_paginas = }")
                # print(f"{total_empresas = }")
                # print(cnpjs['data']['cnpj'])
                for dados in cnpjs['data']['cnpj']:
                    cnpj         = dados['cnpj']
                    razao_social = dados['razao_social'].replace(".", "").replace(" ", "-").lower()
                    url = "https://casadosdados.com.br/solucao/cnpj/" + razao_social + "-" + cnpj

                    if url not in urls_geradas:
                        urls_geradas.append(url)
                        df_url.loc[len(df_url)] = [url]
                    print(f"urls geradas: {len(df_url)}")

    return urls_geradas


def criar_listas_de_busca(municipio):
    if total_threads > len(municipio):
        print("Número de threads é maior que a quantidade de linhas, encerrando...")
        exit()
    lista = {}
    inicio_pesquisa = 0
    fim_pesquisa = 0
    for i in range(0, total_threads):
        pesquisa_por_thread = len(municipio) / total_threads

        if (i * pesquisa_por_thread <=0):
            inicio_pesquisa = int(math.ceil((i * pesquisa_por_thread)))
            fim_pesquisa    = int(math.ceil((i + 1) * pesquisa_por_thread))
        else:
            inicio_pesquisa = int(math.ceil(i * pesquisa_por_thread + 1))
            fim_pesquisa    = int(math.ceil((i + 1) * pesquisa_por_thread))

        lista[f'pesquisa{i}'] = [inicio_pesquisa, fim_pesquisa]

    return lista #, inicio_pesquisa, fim_pesquisa

def criar_threads():
    # Cria as threads e as variaveis
    for i in range(0, total_threads):
        #print(lista[f'pesquisa{i}'][0], lista[f'pesquisa{i}'][1])
        varThread = "t" + str(i)
        globals()[varThread] = threading.Thread(target=consultar, args=(int(listas[f'pesquisa{i}'][0]), int(listas[f'pesquisa{i}'][1])))
    return

def iniciliza_threads():
    # Inicializa cada thread criada
    for i in range(0, total_threads):
        varThread = "t" + str(i)
        globals()[varThread].start()
        print(f"A thread {varThread} foi iniciada com sucesso!")
    return

def aguardar_threads_finalizar():
    conta_threads_finalizadas = 0   # Conta a quantida de threads que forem finalizadas
    lista_threads_finalizadas = []  # Lista que salva cada thread que já foi finalizada
    while True:
        sleep(1)
        for i in range(0, total_threads):
            varThread = "t" + str(i)
            if ( not globals()[varThread].is_alive()):
                if globals()[varThread] not in lista_threads_finalizadas:
                    lista_threads_finalizadas.append(globals()[varThread])
                    print(f"Thread {varThread} foi finalizada")
                    conta_threads_finalizadas += 1

        if(conta_threads_finalizadas == total_threads):
            print("Todas as threads encerradas, salvando dados no CSV...")
            df_url.to_csv('Extraídos.csv', index=False)
            break
    return


if __name__ == "__main__":
    municipios_rs = ['ACEGUA', 'AGUA SANTA', 'AGUDO', 'AJURICABA', 'ALECRIM', 'ALEGRETE', 'ALEGRIA', 'ALMIRANTE TAMANDARE DO SUL', 'ALPESTRE', 'ALTO ALEGRE', 'ALTO FELIZ', 'ALVORADA', 'AMARAL FERRADOR', 'AMETISTA DO SUL', 'ANDRE DA ROCHA', 'ANTA GORDA', 'ANTONIO PRADO', 'ARAMBARE', 'ARARICA', 'ARATIBA', 'ARROIO DO MEIO', 'ARROIO DO PADRE', 'ARROIO DO SAL', 'ARROIO DO TIGRE', 'ARROIO DOS RATOS', 'ARROIO GRANDE', 'ARVOREZINHA', 'AUGUSTO PESTANA', 'AUREA', 'BAGE', 'BALNEARIO PINHAL', 'BARAO', 'BARAO DE COTEGIPE', 'BARAO DO TRIUNFO', 'BARRA DO GUARITA', 'BARRA DO QUARAI', 'BARRA DO RIBEIRO', 'BARRA DO RIO AZUL', 'BARRA FUNDA', 'BARRACAO', 'BARROS CASSAL', 'BENJAMIN CONSTANT DO SUL', 'BENTO GONCALVES', 'BOA VISTA DAS MISSOES', 'BOA VISTA DO BURICA', 'BOA VISTA DO CADEADO', 'BOA VISTA DO INCRA', 'BOA VISTA DO SUL', 'BOM JESUS', 'BOM PRINCIPIO', 'BOM PROGRESSO', 'BOM RETIRO DO SUL', 'BOQUEIRAO DO LEAO', 'BOSSOROCA', 'BOZANO', 'BRAGA', 'BROCHIER', 'BUTIA', 'CACAPAVA DO SUL', 'CACEQUI', 'CACHOEIRA DO SUL', 'CACHOEIRINHA', 'CACIQUE DOBLE', 'CAIBATE', 'CAICARA', 'CAMAQUA', 'CAMARGO', 'CAMBARA DO SUL', 'CAMPESTRE DA SERRA', 'CAMPINA DAS MISSOES', 'CAMPINAS DO SUL', 'CAMPO BOM', 'CAMPO NOVO', 'CAMPOS BORGES', 'CANDELARIA', 'CANDIDO GODOI', 'CANDIOTA', 'CANELA', 'CANGUCU', 'CANOAS', 'CANUDOS DO VALE', 'CAPAO BONITO DO SUL', 'CAPAO DA CANOA', 'CAPAO DO CIPO', 'CAPAO DO LEAO', 'CAPELA DE SANTANA', 'CAPITAO', 'CAPIVARI DO SUL', 'CARAA', 'CARAZINHO', 'CARLOS BARBOSA', 'CARLOS GOMES', 'CASCA', 'CASEIROS', 'CATUIPE', 'CAXIAS DO SUL', 'CENTENARIO', 'CERRITO', 'CERRO BRANCO', 'CERRO GRANDE', 'CERRO GRANDE DO SUL', 'CERRO LARGO', 'CHAPADA', 'CHARQUEADAS', 'CHARRUA', 'CHIAPETTA', 'CHUI', 'CHUVISCA', 'CIDREIRA', 'CIRIACO', 'COLINAS', 'COLORADO', 'CONDOR', 'CONSTANTINA', 'COQUEIRO BAIXO', 'COQUEIROS DO SUL', 'CORONEL BARROS', 'CORONEL BICACO', 'CORONEL PILAR', 'COTIPORA', 'COXILHA', 'CRISSIUMAL', 'CRISTAL', 'CRISTAL DO SUL', 'CRUZ ALTA', 'CRUZALTENSE', 'CRUZEIRO DO SUL', 'DAVID CANABARRO', 'DERRUBADAS', 'DEZESSEIS DE NOVEMBRO', 'DILERMANDO DE AGUIAR', 'DOIS IRMAOS', 'DOIS IRMAOS DAS MISSOES', 'DOIS LAJEADOS', 'DOM FELICIANO', 'DOM PEDRITO', 'DOM PEDRO DE ALCANTARA', 'DONA FRANCISCA', 'DOUTOR MAURICIO CARDOSO', 'DOUTOR RICARDO', 'ELDORADO DO SUL', 'ENCANTADO', 'ENCRUZILHADA DO SUL', 'ENGENHO VELHO', 'ENTRE IJUIS', 'ENTRE RIOS DO SUL', 'EREBANGO', 'ERECHIM', 'ERNESTINA', 'ERVAL GRANDE', 'ERVAL SECO', 'ESMERALDA', 'ESPERANCA DO SUL', 'ESPUMOSO', 'ESTACAO', 'ESTANCIA VELHA', 'ESTEIO', 'ESTRELA', 'ESTRELA VELHA', 'EUGENIO DE CASTRO', 'FAGUNDES VARELA', 'FARROUPILHA', 'FAXINAL DO SOTURNO', 'FAXINALZINHO', 'FAZENDA VILANOVA', 'FELIZ', 'FLORES DA CUNHA', 'FLORIANO PEIXOTO', 'FONTOURA XAVIER', 'FORMIGUEIRO', 'FORQUETINHA', 'FORTALEZA DOS VALOS', 'FREDERICO WESTPHALEN', 'GARIBALDI', 'GARRUCHOS', 'GAURAMA', 'GENERAL CAMARA', 'GENTIL', 'GETULIO VARGAS', 'GIRUA', 'GLORINHA', 'GRAMADO', 'GRAMADO DOS LOUREIROS', 'GRAMADO XAVIER', 'GRAVATAI', 'GUABIJU', 'GUAIBA', 'GUAPORE', 'GUARANI DAS MISSOES', 'HARMONIA', 'HERVAL', 'HERVEIRAS', 'HORIZONTINA', 'HULHA NEGRA', 'HUMAITA', 'IBARAMA', 'IBIACA', 'IBIRAIARAS', 'IBIRAPUITA', 'IBIRUBA', 'IGREJINHA', 'IJUI', 'ILOPOLIS', 'IMBE', 'IMIGRANTE', 'INDEPENDENCIA', 'INHACORA', 'IPE', 'IPIRANGA DO SUL', 'IRAI', 'ITAARA', 'ITACURUBI', 'ITAPUCA', 'ITAQUI', 'ITATI', 'ITATIBA DO SUL', 'IVORA', 'IVOTI', 'JABOTICABA', 'JACUIZINHO', 'JACUTINGA', 'JAGUARAO', 'JAGUARI', 'JAQUIRANA', 'JARI', 'JOIA', 'JULIO DE CASTILHOS', 'LAGOA BONITA DO SUL', 'LAGOA DOS TRES CANTOS', 'LAGOA VERMELHA', 'LAGOAO', 'LAJEADO', 'LAJEADO DO BUGRE', 'LAVRAS DO SUL', 'LIBERATO SALZANO', 'LINDOLFO COLLOR', 'LINHA NOVA', 'MACAMBARA', 'MACHADINHO', 'MAMPITUBA', 'MANOEL VIANA', 'MAQUINE', 'MARATA', 'MARAU', 'MARCELINO RAMOS', 'MARIANA PIMENTEL', 'MARIANO MORO', 'MARQUES DE SOUZA', 'MATA', 'MATO CASTELHANO', 'MATO LEITAO', 'MATO QUEIMADO', 'MAXIMILIANO DE ALMEIDA', 'MINAS DO LEAO', 'MIRAGUAI', 'MONTAURI', 'MONTE ALEGRE DOS CAMPOS', 'MONTE BELO DO SUL', 'MONTENEGRO', 'MORMACO', 'MORRINHOS DO SUL', 'MORRO REDONDO', 'MORRO REUTER', 'MOSTARDAS', 'MUCUM', 'MUITOS CAPOES', 'MULITERNO', 'NAO-ME-TOQUE', 'NICOLAU VERGUEIRO', 'NONOAI', 'NOVA ALVORADA', 'NOVA ARACA', 'NOVA BASSANO', 'NOVA BOA VISTA', 'NOVA BRESCIA', 'NOVA CANDELARIA', 'NOVA ESPERANCA DO SUL', 'NOVA HARTZ', 'NOVA PADUA', 'NOVA PALMA', 'NOVA PETROPOLIS', 'NOVA PRATA', 'NOVA RAMADA', 'NOVA ROMA DO SUL', 'NOVA SANTA RITA', 'NOVO BARREIRO', 'NOVO CABRAIS', 'NOVO HAMBURGO', 'NOVO MACHADO', 'NOVO TIRADENTES', 'NOVO XINGU', 'OSORIO', 'PAIM FILHO', 'PALMARES DO SUL', 'PALMEIRA DAS MISSOES', 'PALMITINHO', 'PANAMBI', 'PANTANO GRANDE', 'PARAI', 'PARAISO DO SUL', 'PARECI NOVO', 'PAROBE', 'PASSA SETE', 'PASSO DO SOBRADO', 'PASSO FUNDO', 'PAULO BENTO', 'PAVERAMA', 'PEDRAS ALTAS', 'PEDRO OSORIO', 'PEJUCARA', 'PELOTAS', 'PICADA CAFE', 'PINHAL', 'PINHAL DA SERRA', 'PINHAL GRANDE', 'PINHEIRINHO DO VALE', 'PINHEIRO MACHADO', 'PINTO BANDEIRA', 'PIRAPO', 'PIRATINI', 'PLANALTO', 'POCO DAS ANTAS', 'PONTAO', 'PONTE PRETA', 'PORTAO', 'PORTO ALEGRE', 'PORTO LUCENA', 'PORTO MAUA', 'PORTO VERA CRUZ', 'PORTO XAVIER', 'POUSO NOVO', 'PRESIDENTE LUCENA', 'PROGRESSO', 'PROTASIO ALVES', 'PUTINGA', 'QUARAI', 'QUATRO IRMAOS', 'QUEVEDOS', 'QUINZE DE NOVEMBRO', 'REDENTORA', 'RELVADO', 'RESTINGA SECA', 'RIO DOS INDIOS', 'RIO GRANDE', 'RIO PARDO', 'RIOZINHO', 'ROCA SALES', 'RODEIO BONITO', 'ROLADOR', 'ROLANTE', 'RONDA ALTA', 'RONDINHA', 'ROQUE GONZALES', 'ROSARIO DO SUL', 'SAGRADA FAMILIA', 'SALDANHA MARINHO', 'SALTO DO JACUI', 'SALVADOR DAS MISSOES', 'SALVADOR DO SUL', 'SANANDUVA', 'SANTA BARBARA DO SUL', 'SANTA CECILIA DO SUL', 'SANTA CLARA DO SUL', 'SANTA CRUZ DO SUL', 'SANTA MARGARIDA DO SUL', 'SANTA MARIA', 'SANTA MARIA DO HERVAL', 'SANTA ROSA', 'SANTA TEREZA', 'SANTA VITORIA DO PALMAR', 'SANTANA DA BOA VISTA', 'SANTANA DO LIVRAMENTO', 'SANTIAGO', 'SANTO ANGELO', 'SANTO ANTONIO DA PATRULHA', 'SANTO ANTONIO DAS MISSOES', 'SANTO ANTONIO DO PALMA', 'SANTO ANTONIO DO PLANALTO', 'SANTO AUGUSTO', 'SANTO CRISTO', 'SANTO EXPEDITO DO SUL', 'SAO BORJA', 'SAO DOMINGOS DO SUL', 'SAO FRANCISCO DE ASSIS', 'SAO FRANCISCO DE PAULA', 'SAO GABRIEL', 'SAO JERONIMO', 'SAO JOAO DA URTIGA', 'SAO JOAO DO POLESINE', 'SAO JORGE', 'SAO JOSE DAS MISSOES', 'SAO JOSE DO HERVAL', 'SAO JOSE DO HORTENCIO', 'SAO JOSE DO INHACORA', 'SAO JOSE DO NORTE', 'SAO JOSE DO OURO', 'SAO JOSE DO SUL', 'SAO JOSE DOS AUSENTES', 'SAO LEOPOLDO', 'SAO LOURENCO DO SUL', 'SAO LUIZ GONZAGA', 'SAO MARCOS', 'SAO MARTINHO', 'SAO MARTINHO DA SERRA', 'SAO MIGUEL DAS MISSOES', 'SAO NICOLAU', 'SAO PAULO DAS MISSOES', 'SAO PEDRO DA SERRA', 'SAO PEDRO DAS MISSOES', 'SAO PEDRO DO BUTIA', 'SAO PEDRO DO SUL', 'SAO SEBASTIAO DO CAI', 'SAO SEPE', 'SAO VALENTIM', 'SAO VALENTIM DO SUL', 'SAO VALERIO DO SUL', 'SAO VENDELINO', 'SAO VICENTE DO SUL', 'SAPIRANGA', 'SAPUCAIA DO SUL', 'SARANDI', 'SEBERI', 'SEDE NOVA', 'SEGREDO', 'SELBACH', 'SENADOR SALGADO FILHO', 'SENTINELA DO SUL', 'SERAFINA CORREA', 'SERIO', 'SERTAO', 'SERTAO SANTANA', 'SETE DE SETEMBRO', 'SEVERIANO DE ALMEIDA', 'SILVEIRA MARTINS', 'SINIMBU', 'SOBRADINHO', 'SOLEDADE', 'TABAI', 'TAPEJARA', 'TAPERA', 'TAPES', 'TAQUARA', 'TAQUARI', 'TAQUARUCU DO SUL', 'TAVARES', 'TENENTE PORTELA', 'TERRA DE AREIA', 'TEUTONIA', 'TIO HUGO', 'TIRADENTES DO SUL', 'TOROPI', 'TORRES', 'TRAMANDAI', 'TRAVESSEIRO', 'TRES ARROIOS', 'TRES CACHOEIRAS', 'TRES COROAS', 'TRES DE MAIO', 'TRES FORQUILHAS', 'TRES PALMEIRAS', 'TRES PASSOS', 'TRINDADE DO SUL', 'TRIUNFO', 'TUCUNDUVA', 'TUNAS', 'TUPANCI DO SUL', 'TUPANCIRETA', 'TUPANDI', 'TUPARENDI', 'TURUCU', 'UBIRETAMA', 'UNIAO DA SERRA', 'UNISTALDA', 'URUGUAIANA', 'VACARIA', 'VALE DO SOL', 'VALE REAL', 'VALE VERDE', 'VANINI', 'VENANCIO AIRES', 'VERA CRUZ', 'VERANOPOLIS', 'VESPASIANO CORREA', 'VIADUTOS', 'VIAMAO', 'VICENTE DUTRA', 'VICTOR GRAEFF', 'VILA FLORES', 'VILA LANGARO', 'VILA MARIA', 'VILA NOVA DO SUL', 'VISTA ALEGRE', 'VISTA ALEGRE DO PRATA', 'VISTA GAUCHA', 'VITORIA DAS MISSOES', 'WESTFALIA', 'XANGRI-LA']
    municipios_mg = ['ABADIA DOS DOURADOS', 'ABAETE', 'ABRE CAMPO', 'ACAIACA', 'ACUCENA', 'AGUA BOA', 'AGUA COMPRIDA', 'AGUANIL', 'AGUAS FORMOSAS', 'AGUAS VERMELHAS', 'AIMORES', 'AIURUOCA', 'ALAGOA', 'ALBERTINA', 'ALEM PARAIBA', 'ALFENAS', 'ALFREDO VASCONCELOS', 'ALMENARA', 'ALPERCATA', 'ALPINOPOLIS', 'ALTEROSA', 'ALTO CAPARAO', 'ALTO JEQUITIBA', 'ALTO RIO DOCE', 'ALVARENGA', 'ALVINOPOLIS', 'ALVORADA DE MINAS', 'AMPARO DA SERRA', 'ANDRADAS', 'ANDRELANDIA', 'ANGELANDIA', 'ANTONIO CARLOS', 'ANTONIO DIAS', 'ANTONIO PRADO DE MINAS', 'ARACAI', 'ARACITABA', 'ARACUAI', 'ARAGUARI', 'ARANTINA', 'ARAPONGA', 'ARAPORA', 'ARAPUA', 'ARAUJOS', 'ARAXA', 'ARCEBURGO', 'ARCOS', 'AREADO', 'ARGIRITA', 'ARICANDUVA', 'ARINOS', 'ASTOLFO DUTRA', 'ATALEIA', 'AUGUSTO DE LIMA', 'BAEPENDI', 'BALDIM', 'BAMBUI', 'BANDEIRA', 'BANDEIRA DO SUL', 'BARAO DE COCAIS', 'BARAO DO MONTE ALTO', 'BARBACENA', 'BARRA LONGA', 'BARROSO', 'BELA VISTA DE MINAS', 'BELMIRO BRAGA', 'BELO HORIZONTE', 'BELO ORIENTE', 'BELO VALE', 'BERILO', 'BERIZAL', 'BERTOPOLIS', 'BETIM', 'BIAS FORTES', 'BICAS', 'BIQUINHAS', 'BOA ESPERANCA', 'BOCAINA DE MINAS', 'BOCAIUVA', 'BOM DESPACHO', 'BOM JARDIM DE MINAS', 'BOM JESUS DA PENHA', 'BOM JESUS DO AMPARO', 'BOM JESUS DO GALHO', 'BOM REPOUSO', 'BOM SUCESSO', 'BONFIM', 'BONFINOPOLIS DE MINAS', 'BONITO DE MINAS', 'BORDA DA MATA', 'BOTELHOS', 'BOTUMIRIM', 'BRAS PIRES', 'BRASILANDIA DE MINAS', 'BRASILIA DE MINAS', 'BRASOPOLIS', 'BRAUNAS', 'BRUMADINHO', 'BUENO BRANDAO', 'BUENOPOLIS', 'BUGRE', 'BURITIS', 'BURITIZEIRO', 'CABECEIRA GRANDE', 'CABO VERDE', 'CACHOEIRA DA PRATA', 'CACHOEIRA DE MINAS', 'CACHOEIRA DE PAJEU', 'CACHOEIRA DOURADA', 'CAETANOPOLIS', 'CAETE', 'CAIANA', 'CAJURI', 'CALDAS', 'CAMACHO', 'CAMANDUCAIA', 'CAMBUI', 'CAMBUQUIRA', 'CAMPANARIO', 'CAMPANHA', 'CAMPESTRE', 'CAMPINA VERDE', 'CAMPO AZUL', 'CAMPO BELO', 'CAMPO DO MEIO', 'CAMPO FLORIDO', 'CAMPOS ALTOS', 'CAMPOS GERAIS', 'CANA VERDE', 'CANAA', 'CANAPOLIS', 'CANDEIAS', 'CANTAGALO', 'CAPARAO', 'CAPELA NOVA', 'CAPELINHA', 'CAPETINGA', 'CAPIM BRANCO', 'CAPINOPOLIS', 'CAPITAO ANDRADE', 'CAPITAO ENEAS', 'CAPITOLIO', 'CAPUTIRA', 'CARAI', 'CARANAIBA', 'CARANDAI', 'CARANGOLA', 'CARATINGA', 'CARBONITA', 'CAREACU', 'CARLOS CHAGAS', 'CARMESIA', 'CARMO DA CACHOEIRA', 'CARMO DA MATA', 'CARMO DE MINAS', 'CARMO DO CAJURU', 'CARMO DO PARANAIBA', 'CARMO DO RIO CLARO', 'CARMOPOLIS DE MINAS', 'CARNEIRINHO', 'CARRANCAS', 'CARVALHOPOLIS', 'CARVALHOS', 'CASA GRANDE', 'CASCALHO RICO', 'CASSIA', 'CATAGUASES', 'CATAS ALTAS', 'CATAS ALTAS DA NORUEGA', 'CATUJI', 'CATUTI', 'CAXAMBU', 'CEDRO DO ABAETE', 'CENTRAL DE MINAS', 'CENTRALINA', 'CHACARA', 'CHALE', 'CHAPADA DO NORTE', 'CHAPADA GAUCHA', 'CHIADOR', 'CIPOTANEA', 'CLARAVAL', 'CLARO DOS POCOES', 'CLAUDIO', 'COIMBRA', 'COLUNA', 'COMENDADOR GOMES', 'COMERCINHO', 'CONCEICAO DA APARECIDA', 'CONCEICAO DA BARRA DE MINAS', 'CONCEICAO DAS ALAGOAS', 'CONCEICAO DAS PEDRAS', 'CONCEICAO DE IPANEMA', 'CONCEICAO DO MATO DENTRO', 'CONCEICAO DO PARA', 'CONCEICAO DO RIO VERDE', 'CONCEICAO DOS OUROS', 'CONEGO MARINHO', 'CONFINS', 'CONGONHAL', 'CONGONHAS', 'CONGONHAS DO NORTE', 'CONQUISTA', 'CONSELHEIRO LAFAIETE', 'CONSELHEIRO PENA', 'CONSOLACAO', 'CONTAGEM', 'COQUEIRAL', 'CORACAO DE JESUS', 'CORDISBURGO', 'CORDISLANDIA', 'CORINTO', 'COROACI', 'COROMANDEL', 'CORONEL FABRICIANO', 'CORONEL MURTA', 'CORONEL PACHECO', 'CORONEL XAVIER CHAVES', 'CORREGO DANTA', 'CORREGO DO BOM JESUS', 'CORREGO FUNDO', 'CORREGO NOVO', 'COUTO DE MAGALHAES DE MINAS', 'CRISOLITA', 'CRISTAIS', 'CRISTALIA', 'CRISTIANO OTONI', 'CRISTINA', 'CRUCILANDIA', 'CRUZEIRO DA FORTALEZA', 'CRUZILIA', 'CUPARAQUE', 'CURRAL DE DENTRO', 'CURVELO', 'DATAS', 'DELFIM MOREIRA', 'DELFINOPOLIS', 'DELTA', 'DESCOBERTO', 'DESTERRO DE ENTRE RIOS', 'DESTERRO DO MELO', 'DIAMANTINA', 'DIOGO DE VASCONCELOS', 'DIONISIO', 'DIVINESIA', 'DIVINO', 'DIVINO DAS LARANJEIRAS', 'DIVINOLANDIA DE MINAS', 'DIVINOPOLIS', 'DIVISA ALEGRE', 'DIVISA NOVA', 'DIVISOPOLIS', 'DOM BOSCO', 'DOM CAVATI', 'DOM JOAQUIM', 'DOM SILVERIO', 'DOM VICOSO', 'DONA EUZEBIA', 'DORES DE CAMPOS', 'DORES DE GUANHAES', 'DORES DO INDAIA', 'DORES DO TURVO', 'DORESOPOLIS', 'DOURADOQUARA', 'DURANDE', 'ELOI MENDES', 'ENGENHEIRO CALDAS', 'ENGENHEIRO NAVARRO', 'ENTRE FOLHAS', 'ENTRE RIOS DE MINAS', 'ERVALIA', 'ESMERALDAS', 'ESPERA FELIZ', 'ESPINOSA', 'ESPIRITO SANTO DO DOURADO', 'ESTIVA', 'ESTRELA DALVA', 'ESTRELA DO INDAIA', 'ESTRELA DO SUL', 'EUGENOPOLIS', 'EWBANK DA CAMARA', 'EXTREMA', 'FAMA', 'FARIA LEMOS', 'FELICIO DOS SANTOS', 'FELISBURGO', 'FELIXLANDIA', 'FERNANDES TOURINHO', 'FERROS', 'FERVEDOURO', 'FLORESTAL', 'FORMIGA', 'FORMOSO', 'FORTALEZA DE MINAS', 'FORTUNA DE MINAS', 'FRANCISCO BADARO', 'FRANCISCO DUMONT', 'FRANCISCO SA', 'FRANCISCOPOLIS', 'FREI GASPAR', 'FREI INOCENCIO', 'FREI LAGONEGRO', 'FRONTEIRA', 'FRONTEIRA DOS VALES', 'FRUTA DE LEITE', 'FRUTAL', 'FUNILANDIA', 'GALILEIA', 'GAMELEIRAS', 'GLAUCILANDIA', 'GOIABEIRA', 'GOIANA', 'GONCALVES', 'GONZAGA', 'GOUVEIA', 'GOVERNADOR VALADARES', 'GRAO MOGOL', 'GRUPIARA', 'GUANHAES', 'GUAPE', 'GUARACIABA', 'GUARACIAMA', 'GUARANESIA', 'GUARANI', 'GUARARA', 'GUARDA-MOR', 'GUAXUPE', 'GUIDOVAL', 'GUIMARANIA', 'GUIRICEMA', 'GURINHATA', 'HELIODORA', 'IAPU', 'IBERTIOGA', 'IBIA', 'IBIAI', 'IBIRACATU', 'IBIRACI', 'IBIRITE', 'IBITIURA DE MINAS', 'IBITURUNA', 'ICARAI DE MINAS', 'IGARAPE', 'IGARATINGA', 'IGUATAMA', 'IJACI', 'ILICINEA', 'IMBE DE MINAS', 'INCONFIDENTES', 'INDAIABIRA', 'INDIANOPOLIS', 'INGAI', 'INHAPIM', 'INHAUMA', 'INIMUTABA', 'IPABA', 'IPANEMA', 'IPATINGA', 'IPIACU', 'IPUIUNA', 'IRAI DE MINAS', 'ITABIRA', 'ITABIRINHA', 'ITABIRITO', 'ITACAMBIRA', 'ITACARAMBI', 'ITAGUARA', 'ITAIPE', 'ITAJUBA', 'ITAMARANDIBA', 'ITAMARATI DE MINAS', 'ITAMBACURI', 'ITAMBE DO MATO DENTRO', 'ITAMOGI', 'ITAMONTE', 'ITANHANDU', 'ITANHOMI', 'ITAOBIM', 'ITAPAGIPE', 'ITAPECERICA', 'ITAPEVA', 'ITATIAIUCU', 'ITAU DE MINAS', 'ITAUNA', 'ITAVERAVA', 'ITINGA', 'ITUETA', 'ITUIUTABA', 'ITUMIRIM', 'ITURAMA', 'ITUTINGA', 'JABOTICATUBAS', 'JACINTO', 'JACUI', 'JACUTINGA', 'JAGUARACU', 'JAIBA', 'JAMPRUCA', 'JANAUBA', 'JANUARIA', 'JAPARAIBA', 'JAPONVAR', 'JECEABA', 'JENIPAPO DE MINAS', 'JEQUERI', 'JEQUITAI', 'JEQUITIBA', 'JEQUITINHONHA', 'JESUANIA', 'JOAIMA', 'JOANESIA', 'JOAO MONLEVADE', 'JOAO PINHEIRO', 'JOAQUIM FELICIO', 'JORDANIA', 'JOSE GONCALVES DE MINAS', 'JOSE RAYDAN', 'JOSENOPOLIS', 'JUATUBA', 'JUIZ DE FORA', 'JURAMENTO', 'JURUAIA', 'JUVENILIA', 'LADAINHA', 'LAGAMAR', 'LAGOA DA PRATA', 'LAGOA DOS PATOS', 'LAGOA DOURADA', 'LAGOA FORMOSA', 'LAGOA GRANDE', 'LAGOA SANTA', 'LAJINHA', 'LAMBARI', 'LAMIM', 'LARANJAL', 'LASSANCE', 'LAVRAS', 'LEANDRO FERREIRA', 'LEME DO PRADO', 'LEOPOLDINA', 'LIBERDADE', 'LIMA DUARTE', 'LIMEIRA DO OESTE', 'LONTRA', 'LUISBURGO', 'LUISLANDIA', 'LUMINARIAS', 'LUZ', 'MACHACALIS', 'MACHADO', 'MADRE DE DEUS DE MINAS', 'MALACACHETA', 'MAMONAS', 'MANGA', 'MANHUACU', 'MANHUMIRIM', 'MANTENA', 'MAR DE ESPANHA', 'MARAVILHAS', 'MARIA DA FE', 'MARIANA', 'MARILAC', 'MARIO CAMPOS', 'MARIPA DE MINAS', 'MARLIERIA', 'MARMELOPOLIS', 'MARTINHO CAMPOS', 'MARTINS SOARES', 'MATA VERDE', 'MATERLANDIA', 'MATEUS LEME', 'MATHIAS LOBATO', 'MATIAS BARBOSA', 'MATIAS CARDOSO', 'MATIPO', 'MATO VERDE', 'MATOZINHOS', 'MATUTINA', 'MEDEIROS', 'MEDINA', 'MENDES PIMENTEL', 'MERCES', 'MESQUITA', 'MINAS NOVAS', 'MINDURI', 'MIRABELA', 'MIRADOURO', 'MIRAI', 'MIRAVANIA', 'MOEDA', 'MOEMA', 'MONJOLOS', 'MONSENHOR PAULO', 'MONTALVANIA', 'MONTE ALEGRE DE MINAS', 'MONTE AZUL', 'MONTE BELO', 'MONTE CARMELO', 'MONTE FORMOSO', 'MONTE SANTO DE MINAS', 'MONTE SIAO', 'MONTES CLAROS', 'MONTEZUMA', 'MORADA NOVA DE MINAS', 'MORRO DA GARCA', 'MORRO DO PILAR', 'MUNHOZ', 'MURIAE', 'MUTUM', 'MUZAMBINHO', 'NACIP RAYDAN', 'NANUQUE', 'NAQUE', 'NATALANDIA', 'NATERCIA', 'NAZARENO', 'NEPOMUCENO', 'NINHEIRA', 'NOVA BELEM', 'NOVA ERA', 'NOVA LIMA', 'NOVA MODICA', 'NOVA PONTE', 'NOVA PORTEIRINHA', 'NOVA RESENDE', 'NOVA SERRANA', 'NOVA UNIAO', 'NOVO CRUZEIRO', 'NOVO ORIENTE DE MINAS', 'NOVORIZONTE', 'OLARIA', "OLHOS-D'AGUA", 'OLIMPIO NORONHA', 'OLIVEIRA', 'OLIVEIRA FORTES', 'ONCA DE PITANGUI', 'ORATORIOS', 'ORIZANIA', 'OURO BRANCO', 'OURO FINO', 'OURO PRETO', 'OURO VERDE DE MINAS', 'PADRE CARVALHO', 'PADRE PARAISO', 'PAI PEDRO', 'PAINEIRAS', 'PAINS', 'PAIVA', 'PALMA', 'PALMOPOLIS', 'PAPAGAIOS', 'PARA DE MINAS', 'PARACATU', 'PARAGUACU', 'PARAISOPOLIS', 'PARAOPEBA', 'PASSA QUATRO', 'PASSA TEMPO', 'PASSA VINTE', 'PASSABEM', 'PASSOS', 'PATIS', 'PATOS DE MINAS', 'PATROCINIO', 'PATROCINIO DO MURIAE', 'PAULA CANDIDO', 'PAULISTAS', 'PAVAO', 'PECANHA', 'PEDRA AZUL', 'PEDRA BONITA', 'PEDRA DO ANTA', 'PEDRA DO INDAIA', 'PEDRA DOURADA', 'PEDRALVA', 'PEDRAS DE MARIA DA CRUZ', 'PEDRINOPOLIS', 'PEDRO LEOPOLDO', 'PEDRO TEIXEIRA', 'PEQUERI', 'PEQUI', 'PERDIGAO', 'PERDIZES', 'PERDOES', 'PERIQUITO', 'PESCADOR', 'PIAU', 'PIEDADE DE CARATINGA', 'PIEDADE DE PONTE NOVA', 'PIEDADE DO RIO GRANDE', 'PIEDADE DOS GERAIS', 'PIMENTA', "PINGO D'AGUA", 'PINTOPOLIS', 'PIRACEMA', 'PIRAJUBA', 'PIRANGA', 'PIRANGUCU', 'PIRANGUINHO', 'PIRAPETINGA', 'PIRAPORA', 'PIRAUBA', 'PITANGUI', 'PIUMHI', 'PLANURA', 'POCO FUNDO', 'POCOS DE CALDAS', 'POCRANE', 'POMPEU', 'PONTE NOVA', 'PONTO CHIQUE', 'PONTO DOS VOLANTES', 'PORTEIRINHA', 'PORTO FIRME', 'POTE', 'POUSO ALEGRE', 'POUSO ALTO', 'PRADOS', 'PRATA', 'PRATAPOLIS', 'PRATINHA', 'PRESIDENTE BERNARDES', 'PRESIDENTE JUSCELINO', 'PRESIDENTE KUBITSCHEK', 'PRESIDENTE OLEGARIO', 'PRUDENTE DE MORAIS', 'QUARTEL GERAL', 'QUELUZITO', 'RAPOSOS', 'RAUL SOARES', 'RECREIO', 'REDUTO', 'RESENDE COSTA', 'RESPLENDOR', 'RESSAQUINHA', 'RIACHINHO', 'RIACHO DOS MACHADOS', 'RIBEIRAO DAS NEVES', 'RIBEIRAO VERMELHO', 'RIO ACIMA', 'RIO CASCA', 'RIO DAS OSTRAS', 'RIO DO PRADO', 'RIO DOCE', 'RIO ESPERA', 'RIO MANSO', 'RIO NOVO', 'RIO PARANAIBA', 'RIO PARDO DE MINAS', 'RIO PIRACICABA', 'RIO POMBA', 'RIO PRETO', 'RIO VERMELHO', 'RITAPOLIS', 'ROCHEDO DE MINAS', 'RODEIRO', 'ROMARIA', 'ROSARIO DA LIMEIRA', 'RUBELITA', 'RUBIM', 'SABARA', 'SABINOPOLIS', 'SACRAMENTO', 'SALINAS', 'SALTO DA DIVISA', 'SANTA BARBARA', 'SANTA BARBARA DO LESTE', 'SANTA BARBARA DO MONTE VERDE', 'SANTA BARBARA DO TUGURIO', 'SANTA CRUZ DE MINAS', 'SANTA CRUZ DE SALINAS', 'SANTA CRUZ DO ESCALVADO', 'SANTA EFIGENIA DE MINAS', 'SANTA FE DE MINAS', 'SANTA HELENA DE MINAS', 'SANTA JULIANA', 'SANTA LUZIA', 'SANTA MARGARIDA', 'SANTA MARIA DE ITABIRA', 'SANTA MARIA DO SALTO', 'SANTA MARIA DO SUACUI', 'SANTA RITA DE CALDAS', 'SANTA RITA DE IBITIPOCA', 'SANTA RITA DE JACUTINGA', 'SANTA RITA DE MINAS', 'SANTA RITA DO ITUETO', 'SANTA RITA DO SAPUCAI', 'SANTA ROSA DA SERRA', 'SANTA VITORIA', 'SANTANA DA VARGEM', 'SANTANA DE CATAGUASES', 'SANTANA DE PIRAPAMA', 'SANTANA DO DESERTO', 'SANTANA DO GARAMBEU', 'SANTANA DO JACARE', 'SANTANA DO MANHUACU', 'SANTANA DO PARAISO', 'SANTANA DO RIACHO', 'SANTANA DOS MONTES', 'SANTO ANTONIO DO AMPARO', 'SANTO ANTONIO DO AVENTUREIRO', 'SANTO ANTONIO DO GRAMA', 'SANTO ANTONIO DO ITAMBE', 'SANTO ANTONIO DO JACINTO', 'SANTO ANTONIO DO MONTE', 'SANTO ANTONIO DO RETIRO', 'SANTO ANTONIO DO RIO ABAIXO', 'SANTO HIPOLITO', 'SANTOS DUMONT', 'SAO BENTO ABADE', 'SAO BRAS DO SUACUI', 'SAO DOMINGOS DAS DORES', 'SAO DOMINGOS DO PRATA', 'SAO FELIX DE MINAS', 'SAO FRANCISCO', 'SAO FRANCISCO DE PAULA', 'SAO FRANCISCO DE SALES', 'SAO FRANCISCO DO GLORIA', 'SAO GERALDO', 'SAO GERALDO DA PIEDADE', 'SAO GERALDO DO BAIXIO', 'SAO GONCALO DO ABAETE', 'SAO GONCALO DO PARA', 'SAO GONCALO DO RIO ABAIXO', 'SAO GONCALO DO RIO PRETO', 'SAO GONCALO DO SAPUCAI', 'SAO GOTARDO', 'SAO JOAO BATISTA DO GLORIA', 'SAO JOAO DA LAGOA', 'SAO JOAO DA MATA', 'SAO JOAO DA PONTE', 'SAO JOAO DAS MISSOES', 'SAO JOAO DEL REI', 'SAO JOAO DO MANHUACU', 'SAO JOAO DO MANTENINHA', 'SAO JOAO DO ORIENTE', 'SAO JOAO DO PACUI', 'SAO JOAO DO PARAISO', 'SAO JOAO EVANGELISTA', 'SAO JOAO NEPOMUCENO', 'SAO JOAQUIM DE BICAS', 'SAO JOSE DA BARRA', 'SAO JOSE DA LAPA', 'SAO JOSE DA SAFIRA', 'SAO JOSE DA VARGINHA', 'SAO JOSE DO ALEGRE', 'SAO JOSE DO DIVINO', 'SAO JOSE DO GOIABAL', 'SAO JOSE DO JACURI', 'SAO JOSE DO MANTIMENTO', 'SAO LOURENCO', 'SAO MIGUEL DO ANTA', 'SAO PEDRO DA UNIAO', 'SAO PEDRO DO SUACUI', 'SAO PEDRO DOS FERROS', 'SAO ROMAO', 'SAO ROQUE DE MINAS', 'SAO SEBASTIAO DA BELA VISTA', 'SAO SEBASTIAO DA VARGEM ALEGRE', 'SAO SEBASTIAO DO ANTA', 'SAO SEBASTIAO DO MARANHAO', 'SAO SEBASTIAO DO OESTE', 'SAO SEBASTIAO DO PARAISO', 'SAO SEBASTIAO DO RIO PRETO', 'SAO SEBASTIAO DO RIO VERDE', 'SAO TIAGO', 'SAO TOMAS DE AQUINO', 'SAO TOME DAS LETRAS', 'SAO VICENTE DE MINAS', 'SAPUCAI-MIRIM', 'SARDOA', 'SARZEDO', 'SEM-PEIXE', 'SENADOR AMARAL', 'SENADOR CORTES', 'SENADOR FIRMINO', 'SENADOR JOSE BENTO', 'SENADOR MODESTINO GONCALVES', 'SENHORA DE OLIVEIRA', 'SENHORA DO PORTO', 'SENHORA DOS REMEDIOS', 'SERICITA', 'SERITINGA', 'SERRA AZUL DE MINAS', 'SERRA DA SAUDADE', 'SERRA DO SALITRE', 'SERRA DOS AIMORES', 'SERRANIA', 'SERRANOPOLIS DE MINAS', 'SERRANOS', 'SERRO', 'SETE LAGOAS', 'SETUBINHA', 'SILVEIRANIA', 'SILVIANOPOLIS', 'SIMAO PEREIRA', 'SIMONESIA', 'SOBRALIA', 'SOLEDADE DE MINAS', 'TABULEIRO', 'TAIOBEIRAS', 'TAPARUBA', 'TAPIRA', 'TAPIRAI', 'TAQUARACU DE MINAS', 'TARUMIRIM', 'TEIXEIRAS', 'TEOFILO OTONI', 'TIMOTEO', 'TIRADENTES', 'TIROS', 'TOCANTINS', 'TOCOS DO MOJI', 'TOLEDO', 'TOMBOS', 'TRES CORACOES', 'TRES MARIAS', 'TRES PONTAS', 'TUMIRITINGA', 'TUPACIGUARA', 'TURMALINA', 'TURVOLANDIA', 'UBA', 'UBAI', 'UBAPORANGA', 'UBERABA', 'UBERLANDIA', 'UMBURATIBA', 'UNAI', 'UNIAO DE MINAS', 'URUANA DE MINAS', 'URUCANIA', 'URUCUIA', 'VARGEM ALEGRE', 'VARGEM BONITA', 'VARGEM GRANDE DO RIO PARDO', 'VARGINHA', 'VARJAO DE MINAS', 'VARZEA DA PALMA', 'VARZELANDIA', 'VAZANTE', 'VERDELANDIA', 'VEREDINHA', 'VERISSIMO', 'VERMELHO NOVO', 'VESPASIANO', 'VICOSA', 'VIEIRAS', 'VIRGEM DA LAPA', 'VIRGINIA', 'VIRGINOPOLIS', 'VIRGOLANDIA', 'VISCONDE DO RIO BRANCO', 'VOLTA GRANDE', 'WENCESLAU BRAZ']
    # municipios_rs = ['CANOAS']
    # municipios_mg = ['SAO JOAO DEL REI']
    municipios_completo = municipios_rs + municipios_mg

    df_url = pd.DataFrame(columns=['urls'])

    data_consultar = (f"{date.today() - timedelta(2)}")

    total_threads = 20

    listas = criar_listas_de_busca(municipios_completo)
    criar_threads()
    iniciliza_threads()
    aguardar_threads_finalizar()




    # thread_qtd = len(municipios_completo) // total_threads

    # # for i in range(total_threads):
    # #     globals()[f'thread_{i}'] = threading.Thread(target=consultar, args=[])

    # for i in range(total_threads):
    #     inicio = i * thread_qtd
    #     fim = (i + 1) * thread_qtd if i < total_threads - 1 else len(municipios_completo)
    #     slice_municipios = municipios_completo[inicio:fim]
    #     thread = threading.Thread(target=consultar, args=(slice_municipios,))
    #     thread.start()
    #     thread.is_alive()

    # df_url.to_csv('Extraídos.csv', index=False)


        























